<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å°ç‹—ä¸“å±åˆ®åˆ®å¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #fdf2f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
            font-family: "PingFang SC", "Microsoft Yahei", sans-serif;
        }
        /* åˆ®åˆ®å¡æ•´ä½“å®¹å™¨ */
        .scratch-card {
            width: 340px;
            max-width: 100%; /* é€‚é…å°å±å¹• */
            background: linear-gradient(135deg, #fff 0%, #fef7fb 100%);
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.1);
            border: 3px solid #fee2e2;
            overflow: hidden;
        }
        /* åˆ®åˆ®å¡é¡¶éƒ¨æ ‡é¢˜åŒº */
        .card-header {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
            text-align: center;
            padding: 15px 0;
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 2px;
            position: relative;
        }
        .card-header::after {
            content: "ğŸ¶";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
        }
        /* åˆ®åˆ®å¡å†…å®¹åŒº */
        .card-body {
            padding: 20px;
            text-align: center;
        }
        .card-body .tips {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 15px;
        }
        /* æ ¸å¿ƒåˆ®å¥–åŒºåŸŸå®¹å™¨ - å…³é”®ï¼šè®¾ç½®ä¸ºç›¸å¯¹å®šä½ï¼Œç¡®ä¿å­å…ƒç´ ç»å¯¹å®šä½æ—¶å®Œå…¨è¦†ç›– */
        .scratch-area {
            width: 100%;
            height: 180px;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            border: 2px dashed #fecdd3;
            background-color: #fff;
            /* é˜²æ­¢å­å…ƒç´ æº¢å‡ºå¯¼è‡´è¦†ç›–ä¸å…¨ */
            display: block;
        }
        /* å¥–å“å±•ç¤ºå±‚ - ç¡®ä¿å’Œåˆ®å¥–åŒºåŒå°ºå¯¸ */
        .prize-display {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #dc2626;
            z-index: 1;
            position: absolute;
            padding: 10px;
            top: 0;
            left: 0;
        }
        /* åˆ®æ“¦ç”»å¸ƒï¼ˆæ¶‚å±‚ï¼‰- ç§»é™¤å›ºå®šå°ºå¯¸ï¼Œé€šè¿‡JSåŠ¨æ€è®¾ç½® */
        #scratchCanvas {
            width: 100%;
            height: 100%;
            z-index: 2;
            position: absolute;
            touch-action: none;
            top: 0;
            left: 0; /* ç¡®ä¿ç”»å¸ƒä»å·¦ä¸Šè§’å¼€å§‹è¦†ç›– */
        }
        /* åˆ®åˆ®å¡åº•éƒ¨æç¤º */
        .card-footer {
            padding: 15px 20px;
            text-align: center;
            font-size: 14px;
            color: #9ca3af;
            border-top: 1px solid #fee2e2;
        }
        /* å†æ¥ä¸€æ¬¡æŒ‰é’® */
        .restart-btn {
            margin-top: 30px;
            padding: 12px 45px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            display: none;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
            transition: all 0.2s ease;
        }
        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.3);
        }
        .restart-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- åˆ®åˆ®å¡ä¸»ä½“ -->
    <div class="scratch-card">
        <div class="card-header">å°ç‹—ä¸“å±åˆ®åˆ®ä¹</div>
        <div class="card-body">
            <p class="tips">åˆ®å¼€æ¶‚å±‚ï¼ŒæŠ½å–ä½ çš„ä¸“å±å¥–åŠ±ï½</p>
            <!-- æ ¸å¿ƒåˆ®å¥–åŒº -->
            <div class="scratch-area" id="scratchArea">
                <div class="prize-display" id="prizeText">åˆ®å¼€çœ‹çœ‹å§âœ¨</div>
                <canvas id="scratchCanvas"></canvas>
            </div>
        </div>
        <div class="card-footer">æœ¬æ¬¡æŠ½å¥–æœ€ç»ˆè§£é‡Šæƒå½’å°ç‹—æ‰€æœ‰ ğŸ¾</div>
    </div>
    <!-- å†æ¥ä¸€æ¬¡æŒ‰é’® -->
    <button class="restart-btn" onclick="resetScratchCard()">å†æ¥ä¸€æ¬¡</button>

    <script>
        // æ ¸å¿ƒå˜é‡åˆå§‹åŒ–
        const canvas = document.getElementById('scratchCanvas');
        const ctx = canvas.getContext('2d');
        const prizeText = document.getElementById('prizeText');
        const restartBtn = document.querySelector('.restart-btn');
        const scratchArea = document.getElementById('scratchArea'); // åˆ®å¥–åŒºå®¹å™¨
        let isScratching = false;
        let scratchPercent = 0;
        const scratchThreshold = 30; // åˆ®å¼€30%è‡ªåŠ¨æ˜¾ç¤ºå…¨éƒ¨
        let currentPrize = '';

        // å¥–å“åˆ—è¡¨åŠæ¦‚ç‡ï¼ˆæ€»å’Œ100ï¼Œæœªä¸­å¥–ã€Œæ”¶è·å°ç‹—çš„ä¸€ä¸ªwinkã€æƒé‡è°ƒæ•´ä¸º75ï¼‰
        const prizes = [
            { name: 'ç‹—ç‹—å¤§é¤', weight: 0.7 },
            { name: 'ä¸€å°æƒ…ä¹¦', weight: 2 },
            { name: 'å¥¶èŒ¶', weight: 2 },
            { name: 'ç‹—ç‹—å ¡', weight: 2 },
            { name: 'å°ç‹—æŠ±æŠ±', weight: 2.5 },
            { name: 'å°ç‹—äº²äº²', weight: 2.5 },
            { name: 'å°ç‹—æè‚©', weight: 2.5 },
            { name: 'å°ç‹—æJio', weight: 2.5 },
            { name: 'å°ç‹—ç¡å‰æ•…äº‹', weight: 2.5 },
            { name: 'æ— æ¡ä»¶è®¤é”™åˆ¸', weight: 2.5 },
            { name: 'åµæ¶æš‚åœåˆ¸', weight: 2.3 },
            { name: 'æ”¶è·å°ç‹—çš„ä¸€ä¸ªwink', weight: 75 }
        ];

        // å…³é”®ï¼šè®¾ç½®Canvaså°ºå¯¸ï¼ŒåŒ¹é…çˆ¶å®¹å™¨å®é™…æ˜¾ç¤ºå°ºå¯¸
        function setCanvasSize() {
            // è·å–åˆ®å¥–åŒºçš„å®é™…å®½é«˜ï¼ˆå«padding/borderä¿®æ­£ï¼‰
            const rect = scratchArea.getBoundingClientRect();
            // è®¾ç½®canvasçš„ç»˜å›¾åˆ†è¾¨ç‡ï¼ˆé¿å…æ¨¡ç³Šï¼‰
            canvas.width = rect.width;
            canvas.height = rect.height;
            // è®¾ç½®canvasçš„æ˜¾ç¤ºå°ºå¯¸ï¼ˆå’Œçˆ¶å®¹å™¨ä¸€è‡´ï¼‰
            canvas.style.width = `${rect.width}px`;
            canvas.style.height = `${rect.height}px`;
        }

        // åˆå§‹åŒ–åˆ®åˆ®å¡ï¼ˆç»˜åˆ¶æ¶‚å±‚+æŠ½å¥–ï¼‰
        function initScratchCard() {
            // å…ˆé‡ç½®canvaså°ºå¯¸
            setCanvasSize();
            
            isScratching = false;
            scratchPercent = 0;
            restartBtn.style.display = 'none';
            prizeText.textContent = 'åˆ®å¼€çœ‹çœ‹å§âœ¨';
            
            // é‡æ–°æŠ½å¥–
            currentPrize = drawPrize();
            
            // ç»˜åˆ¶å®Œæ•´æ¶‚å±‚ï¼ˆè¦†ç›–æ•´ä¸ªcanvasï¼‰
            ctx.fillStyle = '#e5e7eb';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.lineWidth = 35; // åˆ®æ“¦ç¬”è§¦å¤§å°
            ctx.lineCap = 'round';
        }

        // æ¦‚ç‡æŠ½å¥–å‡½æ•°
        function drawPrize() {
            const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
            let randomNum = Math.random() * totalWeight;
            for (const prize of prizes) {
                randomNum -= prize.weight;
                if (randomNum <= 0) return prize.name;
            }
            return 'æ”¶è·å°ç‹—çš„ä¸€ä¸ªwink';
        }

        // åˆ®æ“¦äº¤äº’ - å¼€å§‹
        function startScratch(e) {
            e.preventDefault();
            isScratching = true;
            const pos = getCanvasPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        // åˆ®æ“¦äº¤äº’ - è¿‡ç¨‹
        function scratchMove(e) {
            if (!isScratching) return;
            e.preventDefault();
            const pos = getCanvasPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            calculateScratchPercent();
        }

        // åˆ®æ“¦äº¤äº’ - ç»“æŸ
        function endScratch() {
            isScratching = false;
        }

        // è·å–ç”»å¸ƒç›¸å¯¹ä½ç½®ï¼ˆå…¼å®¹è§¦æ‘¸/é¼ æ ‡ï¼Œé€‚é…åŠ¨æ€å°ºå¯¸ï¼‰
        function getCanvasPos(e) {
            const rect = canvas.getBoundingClientRect();
            let x, y;
            if (e.touches && e.touches[0]) {
                // è§¦æ‘¸äº‹ä»¶
                x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
                y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
            } else {
                // é¼ æ ‡äº‹ä»¶
                x = (e.clientX - rect.left) * (canvas.width / rect.width);
                y = (e.clientY - rect.top) * (canvas.height / rect.height);
            }
            return { x, y };
        }

        // è®¡ç®—åˆ®å¼€é¢ç§¯ç™¾åˆ†æ¯”
        function calculateScratchPercent() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparentPixels = 0;
            // éå†åƒç´ ç‚¹ï¼Œç»Ÿè®¡é€æ˜åƒç´ ï¼ˆalphaé€šé“ä¸º0ï¼‰
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] === 0) transparentPixels++;
            }
            // è®¡ç®—åˆ®å¼€ç™¾åˆ†æ¯”
            scratchPercent = (transparentPixels / (canvas.width * canvas.height)) * 100;
            // è¾¾åˆ°é˜ˆå€¼åˆ™å®Œå…¨æ˜¾ç¤ºå¥–å“
            if (scratchPercent >= scratchThreshold) revealAll();
        }

        // å®Œå…¨æ˜¾ç¤ºå¥–å“
        function revealAll() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // æ¸…ç©ºæ¶‚å±‚
            prizeText.textContent = currentPrize;
            restartBtn.style.display = 'block';
        }

        // é‡ç½®åˆ®åˆ®å¡
        function resetScratchCard() {
            initScratchCard();
        }

        // ç»‘å®šäº¤äº’äº‹ä»¶
        canvas.addEventListener('mousedown', startScratch);
        canvas.addEventListener('mousemove', scratchMove);
        canvas.addEventListener('mouseup', endScratch);
        canvas.addEventListener('mouseleave', endScratch);
        canvas.addEventListener('touchstart', startScratch);
        canvas.addEventListener('touchmove', scratchMove);
        canvas.addEventListener('touchend', endScratch);
        canvas.addEventListener('touchcancel', endScratch);

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°é€‚é…canvas
        window.addEventListener('resize', initScratchCard);

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = initScratchCard;
    </script>
</body>
</html>